# 文件系统



![](https://pic3.zhimg.com/80/v2-b92499b17ed11bc279689ecdb6efb4b6_720w.jpg "")

[https://zhuanlan.zhihu.com/p/183238194](https://zhuanlan.zhihu.com/p/183238194)

## 文件的使用

![](https://pic1.zhimg.com/80/v2-bb6dc369fbf16afbdb088c6c7c26d9cc_1440w.jpg "")

用户通过系统调用来对文件进行crud。

操作系统通过文件描述符来维护打开文件的状态和信息，文件描述符包含：

1. 文件指针
2. 文件打开计数器
3. 文件磁盘位置
4. 访问权限

## 文件的储存

![](https://pic4.zhimg.com/80/v2-e01c7af752461c0794a10f383dbe465b_1440w.jpg "")

#### 索引分配

1. 索引+链表
2. 多级索引

#### Linux Ext 2/3方案

- 如果存放文件所需的数据块小于 10 块，则采用直接查找的方式；
- 如果存放文件所需的数据块超过 10 块，则采用一级间接索引方式；
- 如果前面两种方式都不够存放大文件，则采用二级间接索引方式；
- 如果二级间接索引也不够存放大文件，这采用三级间接索引方式；

## 空闲空间管理

#### 位图法

用二进制数据来表示磁盘中一个区块的使用情况。

## 目录储存

以文件的形式。

## 软链和硬链

![](https://pic4.zhimg.com/80/v2-7cf8cec396a66dca2dd1fcd6dadab537_1440w.jpg "")

![](https://pic3.zhimg.com/80/v2-5606413e1b5d2c727399711d347617a2_1440w.jpg "")

1. hard link
    1. 多个目录项指向一个inode
    2. 只有把所有hard link 和源文件删除，文件才会删除
    3. 不能跨文件系统
2. symbolic link
    1. 重新创建一个文件，该文件inode指向另一个文件
    2. 可以跨文件系统



